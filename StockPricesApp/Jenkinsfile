pipeline {
	agent any
	stages {
		stage('Clean stage') {
			steps {
				dir("StockPricesApp") {
					bat 'mvn clean'
				}
			}
		}
		stage('Compile stage') {
			steps {
				dir("StockPricesApp") {
					bat 'mvn compile'
				}
			}
		}
		stage('Install stage') {
			steps {
				dir("StockPricesApp") {
					bat 'mvn install'
				}
			}
		}
		stage('Docker') {
			steps {
				bat 'docker stop happy_hoover || echo no container running'
				bat 'docker rm happy_hoover || echo no container found'
				bat 'docker rmi stockapp || echo no image found'
				bat 'docker build -t toufiks/stockapp .'
				bat 'docker run -d -p 9999:9090 toufiks/stockapp'
			}
		}
		/*stage('Deploy stage') {
			steps {
				dir("StockPricesApp/target") {
					withEnv(['JENKINS_NODE_COOKIE=DontKillMe']) {
						bat 'start java -Dserver.port=3000 -jar StockPricesApp-0.0.1-SNAPSHOT.jar'
					}
				}
			}
		}*/
	}
}
